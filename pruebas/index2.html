<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora</title>
    <script src="https://cdn.jsdelivr.net/npm/table2excel@1.0.4/dist/table2excel.min.js"></script>
    <script src="https://example.com/fontawesome/v6.5.2/js/fontawesome.js" data-auto-replace-svg="nest"></script>
    <script src="https://kit.fontawesome.com/badfe82668.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</head>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    /* ESTILOS CALCULADORA */
    #calculadora {
        display: flex;
        align-items: center;
        flex-direction: column;
        padding: 20px;
    }

    .caja_alumno {
        width: 300px;
        height: auto;
        border: 1px solid gray;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .caja_alumno span {
        padding: 10px;
        margin-bottom: 5px;
    }

    #notaMedia {
        width: 100%;
        text-align: center;
        margin-top: 10px;
    }

    /* SECCION CLASES SEGUN LA NOTA */
    .suspendido {
        background-color: red;
        color: white;
        padding: 10px;
        border-radius: 8px;
    }

    .aprobado {
        background-color: green;
        color: white;
        padding: 10px;
        border-radius: 8px;
    }

    /* ESTILOS MENU */
    nav {
        background-color: #343a40;
        padding: 10px;
        width: 300px;
        position: absolute;
        left: -320px;
        transition: left 0.4s;
        height: 100vh;
    }

    nav.show {
        left: 0;
    }

    nav ul {
        display: flex;
        flex-direction: column;
        gap: 20px;
        padding: 0;
        list-style: none;
    }

    nav ul li {
        display: flex;
        align-items: center;
    }

    nav ul li a {
        color: white;
        text-decoration: none;
        font-size: 18px;
        display: flex;
        align-items: center;
        padding: 10px 15px;
        border-radius: 4px;
        transition: background-color 0.3s, transform 0.3s;
    }

    nav ul li a:hover {
        background-color: #0056b3;
        transform: translateX(10px);
    }

    nav ul li .fa-li {
        margin-right: 10px;
    }

    /* Modo oscuro */
    #toggleDarkMode {
        position: absolute;
        bottom: 30px;
        width: 80%;
        left: 10%;
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    #toggleDarkMode:hover {
        background-color: #0056b3;
    }

    body.dark-mode {
        background-color: #121212;
        color: #ffffff;
    }

    body.dark-mode .caja_alumno {
        background-color: #1e1e1e;
        border-color: #444;
    }

    body.dark-mode nav {
        background-color: #1e1e1e;
    }

    body.dark-mode nav ul li a {
        color: #ffffff;
    }

    body.dark-mode nav ul li a:hover {
        background-color: #333;
    }

    /* BOTON DEL NAV */
    #toggleButton {
        position: fixed;
        padding: 10px;
        z-index: 100;
        left: 10px;
        cursor: pointer;
        transition: left 0.4s;
        background-color: #343a40;
        color: white;
        border: none;
        border-radius: 4px;
    }

    /* Evitar el desplazamiento horizontal cuando el menú está abierto */
    .no-scroll {
        overflow: hidden;
        position: fixed;
        width: 100%;
    }

    /* Mensajes de error */
    .error {
        color: red;
        font-size: 14px;
        margin-top: -10px;
        margin-bottom: 10px;
    }

    /* Botón limpiar historial */
    #clearHistory {
        margin-top: 20px;
        padding: 10px;
        background-color: #ff0000;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }

    #clearHistory:hover {
        background-color: #cc0000;
    }
</style>

<body>
    <!-- Sección del menú -->
    <button id="toggleButton">☰</button>
    <nav id="sidebar">
        <ul class="fa-ul" style="list-style: none">
            <li><span class="fa-li"><i class="fa fa-table" aria-hidden="true"></i></span><a href="#">Ver historial</a>
            </li>
            <li><span class="fa-li"><i class="fa-regular fa-file-pdf"></i></span><a id="pdfGenerate" href="#">Generar .pdf</a></li>
            <li><span class="fa-li"><i class="far fa-file-excel"></i></span><a id="excelGenerate" href="#">Generar
                    excel</a></li>
        </ul>
        <button id="toggleDarkMode">Modo Oscuro</button>
        <button id="clearHistory">Limpiar Historial</button>
    </nav>
    <!-- Sección tabla de alumnos -->
    <table id="dataTable" hidden>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Nota ejercicios</th>
                <th>Nota examen teorico</th>
                <th>Nota examen practico</th>
                <th>Nota del proyecto</th>
                <th>Nota media</th>
            </tr>
        </thead>
        <tbody id="alumnoDatos">
        </tbody>
    </table>

    <!-- Sección de la calculadora -->
    <div id="calculadora">
        <h1>Calculadora de Notas</h1>
        <div id="datosAlumno">
            <h2>Datos del alumno</h2>
            <div class="caja_alumno" id="datos_alumno">
                <span>Nombre del alumno </span><input id="alumno" class="dataStudent" type="text" />
                <span class="error" id="errorNombre"></span>
                <span>Nota de ejercicios </span><input id="notaEj" class="dataStudent" type="number" />
                <span class="error" id="errorNotaEj"></span>
                <span>Nota del examen teorico </span><input id="notaTe" class="dataStudent" type="number" />
                <span class="error" id="errorNotaTe"></span>
                <span>Nota del examen practico </span><input id="notaPr" class="dataStudent" type="number" />
                <span class="error" id="errorNotaPr"></span>
                <span>Nota del proyecto </span><input id="notaPro" class="dataStudent" type="number" />
                <span class="error" id="errorNotaPro"></span>
                <hr class="lineStudent" />
                <div id="notaMedia" class="studentMedia"></div>
            </div>
            <input id="calcularButton" type="submit" name="submit" value="Calcular">
        </div>
    </div>
</body>

</html>

<script>
    // SECCIÓN PARA EXPORTAR LA TABLA
    // EXCEL
    document.querySelector("#excelGenerate").addEventListener("click", function () {
        let table2excel = new Table2Excel();
        table2excel.export(document.querySelector("#dataTable"), "datosAlumnos");
    });

    // PDF
    document.querySelector("#pdfGenerate").addEventListener("click", function () {
        import('jspdf').then(jsPDF => {
            const { jsPDF: JsPDF } = jsPDF;
            const doc = new JsPDF();
            const table = document.querySelector("#dataTable");
            doc.autoTable({ html: table });
            doc.save("datosAlumnos.pdf");
        });
    });

    // SECCIÓN DE LA CALCULADORA
    document.querySelector("#calcularButton").addEventListener("click", function () {
        let nombre = document.querySelector("#alumno").value;
        let notaEj = parseFloat(document.querySelector("#notaEj").value);
        let notaTe = parseFloat(document.querySelector("#notaTe").value);
        let notaPr = parseFloat(document.querySelector("#notaPr").value);
        let notaPro = parseFloat(document.querySelector("#notaPro").value);

        if (!validateInputs(nombre, notaEj, notaTe, notaPr, notaPro)) {
            return;
        }

        let avgGrade = media(notaEj, notaTe, notaPr, notaPro);
        showGrade(avgGrade);
        createTableBody(nombre, notaEj, notaTe, notaPr, notaPro, avgGrade);
        saveToLocalStorage(nombre, notaEj, notaTe, notaPr, notaPro, avgGrade);
    });

    function validateInputs(nombre, notaEj, notaTe, notaPr, notaPro) {
        let isValid = true;

        if (nombre === "") {
            document.querySelector("#errorNombre").textContent = "Nombre es obligatorio";
            isValid = false;
        } else {
            document.querySelector("#errorNombre").textContent = "";
        }

        if (isNaN(notaEj)) {
            document.querySelector("#errorNotaEj").textContent = "Nota de ejercicios es obligatoria";
            isValid = false;
        } else {
            document.querySelector("#errorNotaEj").textContent = "";
        }

        if (isNaN(notaTe)) {
            document.querySelector("#errorNotaTe").textContent = "Nota de examen teórico es obligatoria";
            isValid = false;
        } else {
            document.querySelector("#errorNotaTe").textContent = "";
        }

        if (isNaN(notaPr)) {
            document.querySelector("#errorNotaPr").textContent = "Nota de examen práctico es obligatoria";
            isValid = false;
        } else {
            document.querySelector("#errorNotaPr").textContent = "";
        }

        if (isNaN(notaPro)) {
            document.querySelector("#errorNotaPro").textContent = "Nota del proyecto es obligatoria";
            isValid = false;
        } else {
            document.querySelector("#errorNotaPro").textContent = "";
        }

        return isValid;
    }

    function showGrade(nota) {
        let divGrade = document.querySelector("#notaMedia");
        divGrade.classList.remove("aprobado", "suspendido");
        divGrade.classList.add(nota > 5 ? "aprobado" : "suspendido")
        divGrade.innerHTML = "<h2> La nota media es: " + nota + "</h2>";
    }

    function media(nota1, nota2, nota3, nota4) {
        let media = ((nota1 * 0.20) + (nota2 * 0.20) + (nota3 * 0.30) + (nota4 * 0.30));
        return media.toFixed(2);
    }

    // SECCIÓN PARA CREAR LA TABLA
    function createTableBody(nombre, nota1, nota2, nota3, nota4, media) {
        var tbody = document.querySelector("#alumnoDatos");
        var nuevaFilaHTML = '<tr>' +
            '<td>' + nombre + '</td>' +
            '<td>' + nota1 + '</td>' +
            '<td>' + nota2 + '</td>' +
            '<td>' + nota3 + '</td>' +
            '<td>' + nota4 + '</td>' +
            '<td>' + media + '</td>' +
            '</tr>';
        tbody.innerHTML += nuevaFilaHTML;
    }

    // SECCIÓN PARA GUARDAR EN LOCAL STORAGE
    function saveToLocalStorage(nombre, notaEj, notaTe, notaPr, notaPro, media) {
        let datosAlumnos = JSON.parse(localStorage.getItem("datosAlumnos")) || [];
        datosAlumnos.push({ nombre, notaEj, notaTe, notaPr, notaPro, media });
        localStorage.setItem("datosAlumnos", JSON.stringify(datosAlumnos));
    }

    // Cargar datos desde Local Storage
    function loadFromLocalStorage() {
        let datosAlumnos = JSON.parse(localStorage.getItem("datosAlumnos")) || [];
        datosAlumnos.forEach(alumno => {
            createTableBody(alumno.nombre, alumno.notaEj, alumno.notaTe, alumno.notaPr, alumno.notaPro, alumno.media);
        });
    }

    // Limpiar historial
    document.querySelector("#clearHistory").addEventListener("click", function () {
        localStorage.removeItem("datosAlumnos");
        document.querySelector("#alumnoDatos").innerHTML = "";
    });

    // Cargar datos al inicio
    window.onload = function () {
        loadFromLocalStorage();
    };

    // SECCIÓN PARA ESTILOS JUNTO JS
    document.querySelector("#toggleButton").addEventListener("click", function () {
        let sidebar = document.querySelector("#sidebar");
        sidebar.classList.toggle('show');
        let button = document.querySelector("#toggleButton");

        if (sidebar.classList.contains('show')) {
            button.style.left = '320px';
            document.body.classList.add('no-scroll'); // Añadir la clase no-scroll
        } else {
            button.style.left = '10px';
            document.body.classList.remove('no-scroll'); // Remover la clase no-scroll
        }
    });

    document.querySelector("#toggleDarkMode").addEventListener("click", function () {
        document.body.classList.toggle("dark-mode");
        this.textContent = document.body.classList.contains("dark-mode") ? "Modo Claro" : "Modo Oscuro";
    });
</script>
